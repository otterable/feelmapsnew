<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Stimmungskompass | DEMO</title>
<link href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" rel="stylesheet"/>
<link href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js">
function saveObjectToBackend(mapObject) {
  fetch('/save_object', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(mapObject),
  })
  .then(response => response.json())
  .then(data => {
    console.log('Success:', data);
console.debug('Object saved:', mapObject);
  })
  .catch((error) => {
    console.error('Error:', error);
  });
}


window.onload = function() {
  fetch('/load_objects')
    .then(response => response.json())
    .then(objects => {
      objects.forEach(obj => {
        // Convert the geocoordinates back to a Leaflet LatLng object or LatLngBounds
        // depending on the type of object (marker, polyline, polygon, etc.)
        // For demonstration, we'll assume it's a simple LatLng for a marker.
        const latLng = L.latLng(obj.geocoordinates[0], obj.geocoordinates[1]);
        const marker = L.marker(latLng, {title: obj.molen_id}).addTo(map);
        if (obj.written_note) {
          marker.bindPopup(obj.written_note);
        }
      });
    })
    .catch((error) => {
      console.error('Error:', error);
    });
};

</script>
<script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
<style type="text/css">body { background-color: #1b1b1b; }
</style>
<style>



/* BASIC CSS START */
body, html {
    margin: 0;
    padding: 0;
    overflow: hidden; /* Prevent scrolling */
    box-sizing: border-box; /* Include padding and border in the element's total width and height */
	font-family: 'Roboto', sans-serif !important;
}

*, *:before, *:after {
    box-sizing: inherit; /* Inherit box-sizing to make sure that padding and border are included in total width and height */
}

#map, #sidebar {
    position: absolute; /* Positioned absolutely to give precise control over their placement */
    top: 15px; /* Consistent margin from the top */
    bottom: 15px; /* Consistent margin from the bottom */
    border-radius: 30px;
}

#map {
    left: 15px; /* Consistent margin from the left */
    right: calc(30% + 15px); /* Adjusting for sidebar width and margin */
}

#sidebar {
    width: calc(30% - 15px); /* Sidebar takes up 30% width minus right margin */
    right: 15px; /* Consistent margin from the right */
    overflow-y: auto; /* Allows for scrolling within the sidebar if the content overflows */
    background: #111111;
    padding: 10px;
}



@media screen and (max-width: 768px) {
    #map, #sidebar {
        position: static; /* Resets to the default flow of the document */
        display: block; /* Ensure that elements are treated as block-level */
        width: calc(100% - 30px); /* Adjust width to account for the margins on both sides */
        height: 50vh; /* Set height to fill half the viewport height */
        margin: 15px; /* Consistent margin */
    }

    #map {
	left: 0px !important;
	        margin-top: 0px !important; /* Consistent margin */
        margin-bottom: 30px !important; /* Maintain margin at the bottom */
    }

    #sidebar {
        margin-top: 15px; /* Maintain margin at the top when stacked */
        margin-bottom: 0; /* No margin at the bottom for the last element */
    }
	 .hide-on-mobile {
        display: none !important;
    }
}
/* BASIC CSS END */



/* CATEGORY BUTTON CSS START */

/* CATEGORY BUTTON CSS END */


/* LEAFLET MAP PILL CSS START */
.leaflet-bar, .leaflet-draw-section, .leaflet-draw-section {
  border-radius: 30px !important;
  background-color: #3a3a3a !important;
}
/* LEAFLET MAP PILL CSS END */



/* LEAFLET MAP ICONS CSS START */
.leaflet-control-zoom-in, .leaflet-control-zoom-out, .leaflet-draw-draw-polyline, .leaflet-draw-draw-polygon, .leaflet-draw-draw-rectangle, .leaflet-draw-draw-circle, .leaflet-draw-draw-marker, .leaflet-draw-draw-circlemarker, .leaflet-draw-edit-edit, .leaflet-draw-edit-remove  {
  background-color: #3a3a3a !important;
  color: white !important;
  border: none !important;
  font-size: 18px !important;
  line-height: 30px !important;
  width: 30px !important;
  height: 30px !important;
}
/* LEAFLET MAP ICONS CSS END */



/* LEAFLET MAP ICON COLOR CHANGE WHEN DISABLED CSS START */
.leaflet-disabled {
  background-color: #111111 !important;
  color: white !important;
}
/* LEAFLET MAP ICON COLOR CHANGE WHEN DISABLED CSS END */



/* LEAFLET MAP ICON BORDER REMOVAL CSS START */
.leaflet-control-zoom-in, .leaflet-control-zoom-out {
  border-top: none !important;
  border-bottom: none !important;
  border-radius: 0 !important;
}
/* LEAFLET MAP ICON BORDER REMOVAL CSS END */



/* LEAFLET MAP ICON MISC CSS START */
.leaflet-bar > a:first-child {
  border-top-left-radius: 30px !important;
  border-top-right-radius: 30px !important;
}

.leaflet-bar > a:last-child {
  border-bottom-left-radius: 30px !important;
  border-bottom-right-radius: 30px !important;
}

.leaflet-control-layers-toggle {
    font-size: 30px;
    line-height: 24px;
    font-weight: bold;
    text-align: center;
    border-radius: 30px;
    background-color: transparent;
    background-repeat: no-repeat;
    background-position: center;
    width: 36px;
    height: 36px;
}

.leaflet-control-layers {
    border-radius: 30px;
    opacity: 1;
}

.leaflet-control-layers::before {
    content: "";
    background-image: url('static/mapicon2.png');
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 30px;
    background-size: cover;
    opacity: 1;
}

.leaflet-control-layers-expanded {
    background-color: #3a3a3a !important;
}

/* Hide the background image when the control layers menu is expanded */
.leaflet-control-layers-expanded::before {
    content: none !important;
}

.leaflet-control-layers-expanded .leaflet-control-layers-list {
    color: white;
    font-size: 15px;
    font-weight: bold;
    padding: 10px;  /* Added padding here */
}

.leaflet-control-layers-selector {
    border: 1px solid white !important;
    margin: 2px !important;
}

.leaflet-popup .leaflet-popup-content-wrapper .leaflet-popup-content {
    font-size: 20px !important;
}

/* Your existing rules for .leaflet-control-layers and .leaflet-top leaflet-right had typos, corrected below */
.leaflet-control-layers.leaflet-control {
    border-radius: 30px;
}

.leaflet-top.leaflet-right {
    border-radius: 50px;
}
/* LEAFLET MAP ICON MISC CSS END */



/* BUTTON MISC CSS START */
.button {
    display: block;
    margin-bottom: 10px;
}

.form-field {
    margin-bottom: 10px;
}
/* BUTTON MISC CSS END */



/* HOVER AND SELECTED BUTTON EFFECT CSS START */
/* Hover effect */
.button-s:hover, .categorybutton:hover, .post-button:hover, .key-div:hover, .pinlist-div:hover, .info-div:hover, .lightswitch-div:hover {
    filter: brightness(85%);
    outline: 3px solid var(--border-hover-color); /* Use custom property for outline color */
    outline-offset: -3px; /* Offset to align with the border edge */
}

/* Default state */
.button-s, .categorybutton, .post-button, .key-div, .pinlist-div, .info-div, .lightswitch-div {
    box-sizing: border-box;
    transition: all 0.2s ease-in-out;
    border: 3px solid transparent; /* Default border */
}


/* Selected effect */
.button-s.selected, .categorybutton.selected, .key-div.selected, .pinlist-div.selected, .info-div.selected, .lightswitch-div.selected {
    filter: brightness(85%);
    outline: 5px solid var(--border-selected-color); /* Use custom property for outline color */
    outline-offset: -5px; /* Offset to align with the border edge */
}

/* HOVER AND SELECTED BUTTON EFFECT CSS END */



/* BUTTON MAIN UNIVERSAL CSS START */
.button-u {
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 14px 0;
    padding: 15px;
    box-sizing: border-box;
    cursor: pointer;
    text-decoration: none;
	    white-space: normal;
    border-radius: 30px;
    transition: background-color 0.2s ease-in-out;
    color: white;
    text-align: center;
    line-height: 1;
    max-height: 40px;
    width: 100%;
}
/* BUTTON MAIN UNIVERSAL CSS END */



/* BUTTON SMALL SIDEBAR CSS START */
/* This button is used mainly for Wie funktionierts. */
.button-s {
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 14px 0;
    padding: 15px;
    box-sizing: border-box;
    cursor: pointer;
    text-decoration: none;
	    white-space: normal;
    border-radius: 30px;
    transition: background-color 0.2s ease-in-out;
    color: white;
    text-align: center;
    line-height: 1;
    max-height: 40px;
    width: 100%;
}
/* BUTTON SMALL SIDEBAR CSS END */



/* CATEGORY BUTTON SIDEBAR CSS START */
.categorybutton {
    font-weight: bold;
    margin: 8px 0;  /* Increased vertical margin for more gap between elements */

    line-height: 1;  /* Adjusted line-height */
    cursor: pointer;
    text-decoration: none;
    display: flex;  /* Changed to flexbox */
    align-items: center;  /* Vertically center content */
    justify-content: center;  /* Horizontally center content */
    width: 100%;
	height: auto;
    box-sizing: border-box;  /* Ensure padding and border are included in the width */
    transition: background-color 0.2s ease-in-out;
    border-radius: 30px;
    text-align: center;

}

.categorybutton h3 {
    padding: 5px 5px;  /* Adds 2px padding to left and right */
    margin: 5px;  /* Removes any default margin */
    color: white;
}

#categorybutton-container {
    width: 100%;
    box-sizing: border-box;
    padding-bottom: 17px; /* Added to ensure 17px space at the bottom */
}
/* CATEGORY BUTTON SIDEBAR CSS END */



/* MARKING PICKER MENU CSS START */
 .menu-markingpicker {
    justify-content: center;
    box-sizing: border-box;
    align-items: center;
    display: flex;
  }

  .menu-markingpicker button {
    width: 50px;
    height: 50px;
    margin: 5px;
    border-radius: 30px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    border: 1px solid #000; /* Adjust border color as needed */
    background-color: #fff; /* Adjust button background color as needed */
  }

  /* This class is to simulate the active state, assuming JavaScript will toggle it */
  .menu-markingpicker button.active {
    background-color: #007bff; /* Adjust active button background color as needed */
    color: white;
  }
/* MARKING PICKER MENU CSS END */



/* CITY PICTURE CSS START */
.logo-img {
max-width: 100%;
width: 100%;
box-sizing: border-box;
height: auto;
display: block;
margin-left:auto;
margin-right:auto;
margin-top: 3px;
margin-bottom: 8px; 
border-radius: 30px;"
/* CITY PICTURE CSS END */



/* SMALL OPTIONS MENU TOP BUTTON CSS START */
/* This CSS makes sure the "smalloptionsmenutop" entity is resized properly */
 .smalloptionsmenutop {
      display: flex;
      justify-content: space-between;
    }
    .left-container, .right-container {
      display: flex;
      align-items: center;
    }
    .pinlist-div, .info-div, .lightswitch-div, .key-div {
      margin: 0 3px;
    }
}

  
    /* Individual icon divs */
    .lightswitch-div, .key-div, .pinlist-div, .info-div {
      flex-direction: row;
    }

    /* Make the containers hidden when screen width is less than 1271px */
    @media (max-width: 1271px) and (min-width: 780px) {
	  .left-container, .right-container, .togglebuttoncontainer {
		display: none;
	  }
	}
	
		/* Icon scaler */
        #keyDiv {
            cursor: pointer;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center; /* Vertically center the image */
        }

        #keyDiv img {
            max-width: 40px;  /* Adjust size as needed */
            height: auto;
            border-radius: 30px;
            margin: 0;
        }
		
        #infoDiv {
            cursor: pointer;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center; /* Vertically center the image */
        }

        #infoDiv img {
            max-width: 40px;  /* Adjust size as needed */
            height: auto;
            border-radius: 30px;
            margin: 0;
        }
		
        #pinlistdiv {
            cursor: pointer;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center; /* Vertically center the image */
        }

        #pinlistdiv img {
            max-width: 40px;  /* Adjust size as needed */
            height: auto;
            border-radius: 30px;
            margin: 0;
        }
		
        #lightswitchDiv {
            cursor: pointer;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center; /* Vertically center the image */
        }

        #lightswitchDiv img {
            max-width: 40px;  /* Adjust size as needed */
            height: auto;
            border-radius: 30px;
            margin: 0;
        }
/* SMALL OPTIONS MENU BUTTON CSS END */


    }
/* PINLIST CONTAINER CSS START */
    .pinlist-container {
        max-height: 379px; /* Assuming each pin entry is around 40px high, adjust as needed */
        overflow-y: auto;
    }
	
    #pins-list, #pins-list th, #pins-list td {
        color: white;
    }
/* PINLIST CONTAINER CSS END */


/* INFO-POPUP CONTAINER CSS START */
/* Takes care of how big the info-popup is gonna be. This popup shows information about each element on the website. */
    #info-popup {
        padding: 20px;
        max-width: 500px;
        font-size: 14px;
        z-index: 1000;  /* Make sure the popup appears above the map */
    }
#info-popup.admin-pindelete-popup {
    max-width: 300px;
}
	
	#info-popup.uigif-counter-popup {
    max-width: 270px;
}

#info-popup.uigif-counter-popup img {
    border-radius: 30px;
}

#info-popup.admin-pinresize-popup {
 max-width: 300px;
}
/* INFO-POPUP CONTAINER CSS END */



/* LEAFLET PIN PLACEMENT POPUP CSS START */
/* This is the popup that appears when you attempt to place a pin or rectangle. */
.leaflet-popup-content-wrapper,.leaflet-popup-tip {
            background-color: #111111 !important;
            color: white !important;
            font-family: 'Roboto', sans-serif !important;
            z-index: 1000 !important;
        }
		
.leaflet-popup-content {
    font-size: 40px; /* Adjust size as needed */
}

/* Styles for the textarea */
.leaflet-popup-content textarea {
    width: 100%;
    box-sizing: border-box;
    margin-bottom: 10px;
    font-weight: bold;
    border: none;
    background-color: #111111;
    color: white; /* Added to make text visible on the dark background */
    cursor: pointer;
    font-size: 20px;
    text-decoration: none;
    display: inline-block;
    border-radius: 10px;
    transition: background-color 0.2s ease-in-out;
    resize: none; /* Disables resizing of the textarea */
}

/* Styles for the Post button */
.leaflet-popup-content button:nth-child(2) {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease-in-out;
}

/* Hover state for the Post button */
.leaflet-popup-content button:nth-child(2):hover {
    background-color: #388E3C;
}

/* Styles for the Cancel button */
.leaflet-popup-content button:nth-child(3) {
    background-color: #B71C1C;
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease-in-out;
}

/* Hover state for the Cancel button */
.leaflet-popup-content button:nth-child(3):hover {
    background-color: #9E0B0B;
}

.leaflet-popup,
.leaflet-popup-content button:nth-child(2), /* Assuming this is the Post button based on previous context */
.leaflet-popup-content button:nth-child(3) { /* Assuming this is the Cancel button based on previous context */
    border-radius: 30px !important;
}

.leaflet-popup-content button:nth-child(2) { /* Assuming this is the Post button */
    margin-right: 10px; /* Adjust the gap as needed */
}

.leaflet-popup-content button:nth-child(1) { /* Assuming this is the first button which could be the Cancel button */
    margin-left: 10px; /* Adjust the gap as needed */
}


/* Additional styles for the textarea */
.leaflet-popup-content textarea {
    color: white !important;
}
/* LEAFLET PIN PLACEMENT POPUP CSS END */



/* MARKER / RECTANGLE ETC ICON CSS START */
  .button-draw {
  border-radius: 30px;
    border: none;
    background-color: transparent;
    cursor: pointer;
    padding: 5px;
  }

  .button-draw img {
    width: 50px; /* Adjust the size as needed */
	  border-radius: 30px;

    height: auto;
  }

  .active img {
    /* You can add styles for the active state of the button here */
  }
/* MARKER / RECTANGLE ETC ICON CSS END */



/* CUSTOM SCROLLBAR CSS START */
/* For Webkit (Chrome, Safari, Edge) */
::-webkit-scrollbar {
    display: none; /* Hide scrollbar for Webkit browsers */
}

/* Hide scrollbar for IE, Edge, and Firefox */
body {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
}

/* Hide scrollbar for Chrome, Safari and Opera */
body::-webkit-scrollbar {
    display: none;
}

/* CUSTOM SCROLLBAR CSS END */



    </style>
</head>
<body>
<?php MAP START ?>
<div id="map">
<?php Counter container, showing how many pins there are currently on the map ?>
<div class="countercontainer" id="counter-container" style="background-color: #3a3a3a;"></div>
</div>
<?php MAP END ?>
<?php SIDEBAR BODY START ?>
<div class="color-111111" id="sidebar" style="background-color: #111111;">
<?php LOGO START ?>
<img class="logo-img" src="static/logo_long.png" style="max-width: 100%; height: auto; display: block; margin-bottom: 7px; border-radius: 0px;"/>
<?php LOGO END ?>
<?php WEBSITE DESCRIPTION START ?>
<h3 class="resistant-h3" style="color: white; text-align: center; margin-top: 5px;">Wie stehen Sie zu den Orten in Ihrer Gemeinde?</h3>
<h3 class="resistant-h3" style="color: white; text-align: center; margin-top: -12px; margin-bottom: 7px">Lassen Sie es uns auf dieser Karte wissen!</h3>
<?php WEBSITE DESCRIPTION END ?>
<!-- SMALL OPTIONS MENU TOP START -->
<div class="smalloptionsmenutop"><div style="display: flex; align-items: center; justify-content: center;"><div class="left-container">
<!-- This button shows the user a list of existing pins -->
<div class="pinlist-div" id="pinlistdiv" onclick="togglePopup()" style="border-radius:30px;">
<img src="static/pinlisticon.png"/>
</div>
<!-- This button shows the user a list of existing pins -->
<div class="info-div" id="infoDiv" style="border-radius:30px;">
<img src="static/infoicon.png"/>
</div>
</div><div class="button-s color-3a3a3a" id="buttonS" onclick="addAndRemoveClass()" style="background-color: #3a3a3a; margin-left:auto; margin-right:auto; width: auto; height: auto; padding: 15px;">
<h3>Wie funktioniert's?</h3>
</div><div class="right-container">
<div class="lightswitch-div" id="lightswitchDiv" style="border-radius:30px;">
<img src="static/sunicon.png"/>
</div>
<div class="key-div" id="keyDiv" style="border-radius:30px;">
<img src="static/keyicon.png"/>
</div>
</div></div></div>
<!-- SMALL OPTIONS MENU TOP END -->
<?php PINLIST CONTAINER MENU START ?>
<?php This container shows the list of all pins present in the map. Source is pins.db ?>
<?php It is toggled when "pinlist-div" is pressed, and replaces static/overlay.jpg ?>
<div class="pinlist-container" id="pinlist-container" style="display:none;">
<div id="search-container">
<input id="search-box" onkeyup="filterPins()" placeholder="Suchen Sie nach einer Pin..." type="text"/>
</div>
<div id="pins-list" style="color:white;">
<table>
<tr>
<th></th>
</tr>
        {% for pin in pins %}
        <tr class="pin-row" data-lat="{{ pin.lat }}" data-lon="{{ pin.lon }}">
<td>
<div style="background-color: #{{ pin.pin_type }}; 
                            width: 24px; 
                            height: 24px; 
                            border-radius: 50%;
                            display: inline-block;">
</div>
</td>
<td>{{ pin.description }}</td>
</tr>
        {% endfor %}
    </table>
</div>
</div>
<?php PINLIST CONTAINER MENU END ?>
<?php CITY LOGO START ?>
<img class="hide-on-mobile resistant-image" id="overlay-image" src="static/overlay.jpg" style="max-width: 100%; height: auto; display: block; margin-left:auto; margin-right:auto; margin-top: 3px; margin-bottom: 8px; border-radius: 30px;"/>
<?php CITY LOGO END ?>
<?php MARKING PICKER START ?>
<div class="menu-markingpicker">
<button class="button-draw active" data-type="marker" id="btn-pin">
<img alt="Pin" src="static/objecticon_pin.png"/>
</button>
<button class="button-draw" data-type="rectangle" id="btn-rectangle">
<img alt="Rectangle" src="static/objecticon_rectangle.png"/>
</button>
<button class="button-draw" data-type="circle" id="btn-circle">
<img alt="Circle" src="static/objecticon_circle.png"/>
</button>
<button class="button-draw" data-type="polygon" id="btn-polygon">
<img alt="Polygon" src="static/objecticon_polygon.png"/>
</button>
</div>
<?php MARKING PICKER END ?>
<?php ADMIN TOOLS (OTP PROTECTED) START // Categories here are dynamically generated from the "static/categories.html" file. Additional categories can be added or removed by editing "static/categories.html".?>
<div class="menu-admintools" id="dynamicgeneration-admintools"></div>
<?php ADMIN TOOLS (OTP PROTECTED) END // Categories here are dynamically generated from the "static/categories.html" file. Additional categories can be added or removed by editing "static/categories.html".?>
<?php CATEGORY PICKER START // Categories here are dynamically generated from the "static/categories.html" file. Additional categories can be added or removed by editing "static/categories.html".?>
<div class="menu-categorypicker" id="dynamicgeneration-categorypicker"></div>
<?php CATEGORY PICKER END ?>
</div>
<?php SIDEBAR BODY END ?>
<!-- Button to enable heatmap -->
<div style="position: fixed; bottom: 20px; right: 20px; z-index: 0; opacity: 0">
<button id="enableHeatmap" onclick="toggleHeatmap()">Enable Heatmap</button>
</div>
<script>
function handleLogin() {
  // Assuming you have form inputs with IDs 'username', 'password', and 'otp'
  var username = document.getElementById('username').value;
  var password = document.getElementById('password').value;
  var otp_token = document.getElementById('otp').value;

  // Create an AJAX request to the server for logging in
  var xhr = new XMLHttpRequest();
  xhr.open('POST', '/login', true);
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.onload = function() {
    if (this.status === 200) {
      // If login is successful, load the admin tools
      loadAdminTools();
    } else {
      // Handle login failure, maybe show an error message
      console.error('Login failed:', this.responseText);
    }
  };
  xhr.onerror = function() {
    // When an error occurs during the request
    console.error("Request failed.");
  };
  xhr.send(`username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}&otp=${encodeURIComponent(otp_token)}`);
}


document.addEventListener('DOMContentLoaded', function() {
    // Make sure this is called when the admintools are loaded
    if (document.getElementById('recolorCategory')) {
        initializeRecolorFunctionality();
    }
});

// Initialize recoloring functionality
function initializeRecolorFunctionality() {
    var dropdown = document.getElementById('recolor-category-dropdown');
    var currentColorDisplay = document.getElementById('current-color-display');

    // Event listener to the recolor button
    document.getElementById('recolorCategory').addEventListener('click', function() {
        var selectedCategory = dropdown.value;
        var newColor = document.getElementById('new-color').value.replace('#', ''); // Make sure to replace '#' in color value

        fetch('/recolor-category', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ categoryName: selectedCategory, newColor: newColor })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(result => {
            console.log('Category recolored:', result);
            refreshCategoriesDisplay(); // Make sure this function is defined and updates the display
            updateCurrentColorDisplay(selectedCategory); // Update the current color display
        })
        .catch(error => {
            console.error('Error recoloring category:', error);
        });
		    updateAllCategoryDropdowns();

    });
}

// Function to initialize the delete category dropdown
function initializeDeleteCategoryDropdown() {
  // Fetch the categories from the Flask endpoint
  fetch('/get-categories-renaming')
  .then(response => response.json())
  .then(categories => {
    var dropdown = document.getElementById('delete-category-dropdown');
    dropdown.innerHTML = ''; // Clear existing options
    
    categories.forEach(function(category) {
      var option = document.createElement('option');
      option.value = option.text = category;
      dropdown.appendChild(option);
    });
  })
  .catch(error => {
    console.error('Error fetching categories:', error);
  });
}

// Function to initialize the delete button
function initializeDeleteCategoryButton() {
  var deleteButton = document.getElementById('deleteCategory');
  deleteButton.addEventListener('click', function() {
    var selectedCategory = document.getElementById('delete-category-dropdown').value;

    fetch('/delete-category', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ categoryName: selectedCategory })
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(result => {
      console.log('Category deleted:', result);
      initializeDeleteCategoryDropdown(); // Re-initialize the dropdown
      refreshCategoriesDisplay(); // Refresh the categories displayed on the page
    })
    .catch(error => {
      console.error('Error deleting category:', error);
    });
	    updateAllCategoryDropdowns();
  });
}

function updateAllCategoryDropdowns() {
  // Fetch the categories from the Flask endpoint
  fetch('/get-categories-renaming')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(categories => {
    const dropdowns = [
      document.getElementById('rename-category-dropdown'),
      document.getElementById('recolor-category-dropdown'),
      document.getElementById('delete-category-dropdown')
    ];

    dropdowns.forEach(dropdown => {
      dropdown.innerHTML = ''; // Clear existing options

      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = option.textContent = category;
        dropdown.appendChild(option);
      });
    });
  })
  .catch(error => {
    console.error('Error fetching categories:', error);
  });
}


function loadAdminTools() {
  console.log("Attempting to load admin tools..."); // For debugging

  // Make an AJAX request to the server for the admintools content
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '/admintools', true);
  xhr.onload = function() {
    if (this.status === 200) {
      // If the content is received successfully, insert it into the page
      var dynamicArea = document.getElementById('dynamicgeneration-admintools');
      dynamicArea.innerHTML = this.responseText;

      // Call the initialization functions for dynamic content here
      initializeCategoryDropdown(); // Initialize the dropdown after content is loaded
      initializeRenameCategoryButton(); // Initialize the rename button after content is loaded
      initializeRecolorDropdown(); // Initialize the recolor dropdown
      initializeRecolorFunctionality(); // Initialize the recolor button
      initializeAddCategory(); // Initialize the add category button
      initializeDeleteCategoryDropdown(); // Initialize the delete category dropdown
      initializeDeleteCategoryButton(); // Initialize the delete category button
      refreshCategoriesDisplay(); // Refresh categories after admin tools are loaded - This line was updated

    } else {
      // Handle errors, maybe redirect to login or show a message
      console.error('Failed to load admin tools:', this.statusText);
    }
  };
  xhr.onerror = function() {
    // When an error occurs during the request
    console.error("Request failed.");
  };
  xhr.send();
}

function initializeCategoryDropdown() {
  // Fetch the categories from the Flask endpoint
  fetch('/get-categories-renaming')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(categories => {
    console.log('Categories:', categories); // Add this line for debugging
    var dropdown = document.getElementById('rename-category-dropdown');
    
    // Clear existing options
    dropdown.innerHTML = '';
    
    // Populate dropdown with categories fetched from the server
    categories.forEach(function(category) {
      var option = document.createElement('option');
      option.value = option.text = category;
      dropdown.appendChild(option);
    });
  })
  .catch(error => {
    console.error('Error fetching categories:', error);
  });
}

// Function to refresh the categories displayed on the page
function refreshCategoriesDisplay() {
  // Make an AJAX request to the server for the updated categories content
  fetch('/static/categories.html')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.text();
  })
  .then(categoriesHtml => {
    // Insert the updated categories HTML into the page
    document.getElementById('dynamicgeneration-categorypicker').innerHTML = categoriesHtml;
  })
  .catch(error => {
    console.error('Error refreshing categories:', error);
  });
}

// Update the initializeRenameCategoryButton function to call refreshCategoriesDisplay after a successful rename
function initializeRenameCategoryButton() {
  var renameButton = document.getElementById('renameCategory');
  renameButton.addEventListener('click', function() {
    var selectedCategory = document.getElementById('rename-category-dropdown').value;
    var newCategoryName = document.getElementById('new-category-name').value;

    if (!selectedCategory || !newCategoryName) {
      console.error('Please select a category and enter a new name.');
      return;
    }

    var data = {
      oldName: selectedCategory,
      newName: newCategoryName
    };

    fetch('/rename-category', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.text();
    })
    .then(result => {
      console.log('Category renamed:', result);
      refreshCategoriesDisplay(); // Refresh the categories in the display
      initializeCategoryDropdown(); // Re-initialize the dropdown to reflect the new changes
    })
    .catch(error => {
      console.error('Error renaming category:', error);
    });
	    updateAllCategoryDropdowns();

  });
}

// Initializes the dropdown for recoloring categories
function initializeRecolorDropdown() {
  // Fetch categories and populate dropdown
  fetch('/get-categories-renaming')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(categories => {
      const recolorDropdown = document.getElementById('recolor-category-dropdown');
      recolorDropdown.innerHTML = '';

      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = option.textContent = category;
        recolorDropdown.appendChild(option);
      });

      // Add event listener to update current color display
      recolorDropdown.addEventListener('change', function() {
        updateCurrentColorDisplay(this.value);
      });

      // Update current color display when dropdown is initialized
      updateCurrentColorDisplay(recolorDropdown.value);
    })
    .catch(error => {
      console.error('Error fetching categories for recoloring:', error);
    });
}

// Updates the current color display
function updateCurrentColorDisplay(categoryName) {
  fetch('/get-current-color', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ categoryName: categoryName })
  })
  .then(response => response.json())
  .then(data => {
    document.getElementById('current-color-display').style.backgroundColor = '#' + data.currentColor;
  })
  .catch(error => {
    console.error('Error fetching current color:', error);
  });
}


// Event listener for "Umfärben" button click
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('recolorCategory').addEventListener('click', function() {
    var selectedCategory = document.getElementById('recolor-category-dropdown').value;
    var newColor = document.getElementById('new-color').value;

    fetch('/recolor-category', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ categoryName: selectedCategory, newColor: newColor.replace('#', '') })
    })
    .then(response => response.json())
    .then(result => {
      console.log('Category recolored:', result);
      updateCurrentColorDisplay(selectedCategory);
      refreshCategoriesDisplay();
    })
    .catch(error => {
      console.error('Error recoloring category:', error);
    });
  });
});


function initializeAddCategory() {
    var addCategoryButton = document.getElementById('addCategory');
    addCategoryButton.addEventListener('click', function() {
        var categoryTitle = document.getElementById('new-category-title').value;
        var categoryColor = document.getElementById('new-category-color').value.replace('#', '');

        if (!categoryTitle || !categoryColor) {
            console.error('Please enter a category title and select a color.');
            return;
        }

        fetch('/add-category', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ title: categoryTitle, color: categoryColor })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                console.log('Category added:', data.message);
                refreshCategoriesDisplay(); // Updated this line
				                updateAllCategoryDropdowns(); // Update all category dropdowns

            } else {
                console.error('Error adding category:', data.error);
            }
        })
        .catch(error => {
            console.error('Error adding category:', error);
        });
    });
}

// Call this function after the dynamically loaded content is inserted into the DOM
function dynamicContentLoaded() {
    initializeAddCategoryButton();
    // ... (initialize other dynamic content here if needed)
}

// Use DOMContentLoaded to ensure the button is available when the script runs
document.addEventListener('DOMContentLoaded', function() {
    // Only call this if 'addCategory' exists on initial page load
    if (document.getElementById('addCategory')) {
        initializeAddCategoryButton();
    }
    // ... (call other initialize functions here if needed)
});

// If the button is loaded dynamically, call dynamicContentLoaded()
// after 
	
	
	
</script>


<?php MAP SCRIPT (INITIALIZATION / LAYERS / OBJECTS)  START ?>
<script>
	
		
		// MAP LOADING
        var map = L.map('map').setView([48.4102, 15.6022], 10);
		    map.setMinZoom(15);



// Map layers
var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Ermine | Stimmungskompass v3.11.2023_rc1, Tiles © OpenStreetMap contributors.....'
});

var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    maxZoom: 19,
    attribution: 'Ermine | Stimmungskompass v3.11.2023_rc1, Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community.....'
});

var thunderforestLayers = {
    "Atlas": L.tileLayer('https://tile.thunderforest.com/atlas/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
        maxZoom: 19,
        attribution: 'Ermine | Stimmungskompass v3.11.2023_rc1, Tiles © Thunderforest, © OpenStreetMap contributors.....'
    }),
    "Neighbourhood": L.tileLayer('https://tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
        maxZoom: 19,
        attribution: 'Ermine | Stimmungskompass v3.11.2023_rc1, Tiles © Thunderforest, © OpenStreetMap contributors.....'
    }),
    "Transport": L.tileLayer('https://tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
        maxZoom: 19,
        attribution: 'Ermine | Stimmungskompass v3.11.2023_rc1, Tiles © Thunderforest, © OpenStreetMap contributors.....'
    }),
    "Cycle": L.tileLayer('https://tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
        maxZoom: 19,
        attribution: 'Ermine | Stimmungskompass v3.11.2023_rc1, Tiles © Thunderforest, © OpenStreetMap contributors.....'
    }),
    "Mobile_Atlas": L.tileLayer('https://tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
        maxZoom: 19,
        attribution: 'Ermine | Stimmungskompass v3.11.2023_rc1, Tiles © Thunderforest, © OpenStreetMap contributors.....'
    }),
    "Pioneer": L.tileLayer('https://tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey=5c57f95ca93348f1a37f6572742a5b48', {
        maxZoom: 19,
        attribution: 'Ermine | Stimmungskompass v3.11.2023_rc1, Tiles © Thunderforest, © OpenStreetMap contributors.....'
    }),
};

var baseLayers = {
    "Standardkarte": osmLayer,
    "Satellit": satelliteLayer,
    "Klar 1": thunderforestLayers.Atlas,
    "Klar 2": thunderforestLayers.Neighbourhood,
    "Öffi": thunderforestLayers.Transport,
    "Radwege": thunderforestLayers.Cycle,
    "Atlas": thunderforestLayers.Mobile_Atlas,
    "Papyrus": thunderforestLayers.Pioneer,
};


        // Add default layer to map
        baseLayers["Standardkarte"].addTo(map);

        // Layers control
        L.control.layers(baseLayers).addTo(map);


        
// PIN PLACEMENT LOGIC (ASSIGNING COLORS, OBJECT_ID, MOLEN_ID, CATEGORY_ID, AND HEXCOLOR), START
// Function to generate a random Molen ID with 'M_' prefix and 9 digit number
function generateMolenId() {
    // Generate a random number between 100000000 and 999999999
    var number = Math.floor(Math.random() * (999999999 - 100000000 + 1)) + 100000000;
    return 'M_' + number;
}

// Function to handle map object creation
map.on('draw:created', function (e) {
    // Check if a category is selected
    if (!selectedCategory) {
        console.log('No category selected');
        alert('Please select a category before placing an object on the map.');
        return;
    }

    // Check if an object type is selected (using selectedObjectId)
    if (!selectedObjectId) {
        console.log('No object type selected');
        alert('Please select an object type before placing an object on the map.');
        return;
    }
	
    var layer = e.layer;

        // Depending on the object type, apply different properties
    if (e.layerType === 'marker') {
        // Create a custom icon for the marker
        var customIcon = L.divIcon({
            className: 'custom-div-icon',
            html: `<div style='background-color: #${selectedCategory}; width: 24px; height: 24px; border-radius: 50%;'></div>`,
            iconSize: [24, 24],
            iconAnchor: [12, 24]
        });
        layer.setIcon(customIcon);
    } else if (typeof layer.setStyle === 'function') {
        // Set the style of the object based on the selected category's color
        // This is assuming that only polygon, polyline, or other vector layers would have setStyle
        layer.setStyle({
            color: `#${selectedCategory}`,
            fillColor: `#${selectedCategory}`,
            fillOpacity: 0.5
        });
    }

    // Get a unique ID for the object
    var molenId = generateMolenId();

    // Create the object with the specified properties
    var layer = e.layer;
    var objectProperties = {
        hexColor: selectedCategory,
        categoryId: selectedCategory, // Assuming this is meant to be the category color
        objectId: selectedObjectId,
        molenId: molenId,
        highlightId: null // Set highlightId to null by default
    };

    console.log('Object properties:', objectProperties);

    if (selectedObjectId === 'PIN') {
        // Create a custom icon for the marker
        var customIcon = L.divIcon({
            className: 'custom-div-icon',
            html: `<div style='background-color: #${selectedCategory}; width: 24px; height: 24px; border-radius: 50%;'></div>`,
            iconSize: [24, 24],
            iconAnchor: [12, 24] // Centers the icon and sets the anchor point at the bottom center
        });
        layer.setIcon(customIcon);
    } else {
        // Set the style of the object based on the selected category's color
        layer.setStyle({
            color: `#${selectedCategory}`, // Stroke color
            fillColor: `#${selectedCategory}`, // Fill color
            fillOpacity: 0.5 // You can adjust the opacity as needed
        });
    }

    // Store the object properties in the layer
    layer.objectProperties = objectProperties;

    // Add the layer to the map
    drawnItems.addLayer(layer);

    // Save the object to localStorage for persistence
    var savedObjects = JSON.parse(localStorage.getItem('mapObjects')) || [];
    savedObjects.push({
        type: e.layerType,
        properties: objectProperties,
        latlngs: layer.toGeoJSON().geometry.coordinates
    });
    localStorage.setItem('mapObjects', JSON.stringify(savedObjects));

    console.log('Object added to map with molen_id:', molenId);
});
    </script>
<?php MAP SCRIPT (INITIALIZATION / LAYERS / PIN PLACEMENT / SAVING PINS TO PINS.DB )  END ?>
<?php MARKING PICKER MENU SCRIPT START ?>
<script>


// INITIALIZZATION OF STORING DRAWN ITEMS ON LAYERS, START
var drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);
// INITIALIZZATION OF STORING DRAWN ITEMS ON LAYERS, END

// INITIALIZATION OF DRAWING TOOLBAR (PINS/RECTANGLES/CIRCLES/POLYGONS), START
var drawControl = new L.Control.Draw({
  edit: {
    featureGroup: drawnItems
  },
  draw: {
    polyline: false,
    polygon: {
      shapeOptions: {
        // options here
      },
      allowIntersection: false, // Restricts shapes to simple polygons
      drawError: {
        color: '#e1e100', // Color the shape will turn when intersects
        message: '<strong>Oh snap!<strong> you can\'t draw that!' // Message that will show when intersect
      },
      metric: true,
      repeatMode: false
    },
    circle: {
      shapeOptions: {
        // options here
      },
      metric: true,
      repeatMode: false
    },
    rectangle: {
      shapeOptions: {
        // options here
      },
      metric: true,
      repeatMode: false
    },
    marker: true
  }
});
  // INITIALIZZATION OF STORING DRAWN ITEMS ON LAYERS, START
  var drawnItems = new L.FeatureGroup();
  map.addLayer(drawnItems);
  // INITIALIZZATION OF STORING DRAWN ITEMS ON LAYERS, END



  // INITIALIZATION OF DRAWING TOOLBAR (PINS/RECTANGLES/CIRCLES/POLYGONS, AND NOT ADDING IT TO THE MAP, START
  var drawControl = new L.Control.Draw({
    edit: {
      featureGroup: drawnItems
    },
    draw: {
      polyline: false,
      polygon: true,
      circle: true,
      rectangle: true,
      marker: true
    }
  });
  // INITIALIZATION OF DRAWING TOOLBAR (PINS/RECTANGLES/CIRCLES/POLYGONS, AND NOT ADDING IT TO THE MAP, END



// DRAWING FUNCTIONALITY START
function startDrawing(drawType) {
  if (drawType === 'marker') {
    new L.Draw.Marker(map, drawControl.options.draw.marker).enable();
  } else if (drawType === 'rectangle') {
    new L.Draw.Rectangle(map, drawControl.options.draw.rectangle).enable();
  } else if (drawType === 'circle') {
    new L.Draw.Circle(map, drawControl.options.draw.circle).enable();
  } else if (drawType === 'polygon') {
    new L.Draw.Polygon(map, drawControl.options.draw.polygon).enable();
  }
}
// DRAWING FUNCTIONALITY END

// BUTTON TOGGLING FUNCTIONALITY START
document.querySelectorAll('.menu-markingpicker .button-draw').forEach(button => {
  button.addEventListener('click', function() {
    document.querySelectorAll('.menu-markingpicker .button-draw').forEach(btn => btn.classList.remove('active'));
    this.classList.add('active');
    startDrawing(this.getAttribute('data-type'));
  });
});
// BUTTON TOGGLING FUNCTIONALITY END

// POPUP CREATION LOGIC START
var currentPopupLayer = null; // Track the current layer with a popup

function createPopup(layer) {
  var content = document.createElement('div');

  var textArea = document.createElement('textarea');
  textArea.placeholder = 'Write a note...';
  textArea.style.minWidth = '200px'; // Ensure the textarea is wide enough

  var postButton = document.createElement('button');
  postButton.textContent = 'Post';
  postButton.onclick = function(event) {
    event.stopPropagation(); // Prevent the map click event from firing
	
  // Prepare the object data to be sent to the server
    var objectData = {
        geocoordinates: JSON.stringify(layer.getLatLngs()),
        written_note: textArea.value.trim(),
        categoryid: layer.objectProperties.categoryId,
        hexColor: layer.objectProperties.hexColor,
        molenId: layer.objectProperties.molenId,
        objectId: layer.objectProperties.objectId,
        highlightId: layer.objectProperties.highlightId
    };

    // AJAX call to send the data to the server
    fetch('/save_object', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(objectData),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
    })
    .catch((error) => {
        console.error('Error:', error);
    });
};

// Load objects from the database when the map loads
map.on('load', function() {
    fetch('/get_objects')
    .then(response => response.json())
    .then(objects => {
        objects.forEach(obj => {
            // Convert geocoordinates back to a suitable format for Leaflet
            var latLngs = JSON.parse(obj.geocoordinates);

            // Create the object on the map using Leaflet functions
            // For example, if it's a polyline:
            L.polyline(latLngs, { color: obj.hexColor }).addTo(map);
    if (textArea.value.trim() === '') {
      alert('Please write a note before posting.');
      return;
    }
    layer.note = textArea.value;
    layer.bindPopup(layer.note);
    layer.openPopup();
    currentPopupLayer = null; // Reset the current popup layer as the note is posted
  };

  var cancelButton = document.createElement('button');
  cancelButton.textContent = 'Cancel';
  cancelButton.onclick = function(event) {
    event.stopPropagation(); // Prevent the map click event from firing
    map.removeLayer(layer);
    currentPopupLayer = null; // Reset the current popup layer as it's being removed
  };

  content.appendChild(textArea);
  content.appendChild(postButton);
  content.appendChild(cancelButton);

  layer.bindPopup(content);
  
  setTimeout(() => {
    currentPopupLayer = layer; // Set the current layer when the popup is opened
    layer.openPopup();
  }, 10);

  // Attach an event listener for when the popup is closed using the close button
  layer.on('popupclose', function() {
    if (currentPopupLayer && !layer.note) {
      map.removeLayer(layer);
      currentPopupLayer = null;
    }
  });
}

map.on(L.Draw.Event.CREATED, function (event) {
  var layer = event.layer;
  drawnItems.addLayer(layer);
  createPopup(layer);
  layer.on('click', function() {
    if (layer.note) {
      layer.openPopup();
    }
  });
});

// Remove the layer if the user clicks on the map while the popup is open without posting
map.on('click', function() {
  if (currentPopupLayer) {
    map.removeLayer(currentPopupLayer);
    currentPopupLayer = null;
  }
});

// Prevent map click event from firing when clicking on the popup itself
map.on('popupopen', function(event) {
  event.popup._container.addEventListener('click', function(event) {
    event.stopPropagation();
  });
});
// POPUP CREATION LOGIC END

// No need to manually iterate through each layer on map click anymore, 
// as each layer has its own click event to handle the popup

</script>
<?php MARKING PICKER MENU SCRIPT END ?>
<?php CATEGORY PICKER MENU SCRIPT (GRABBING CATEGORIES FROM "static/categories.html")  START
// Here, the script gathers categories from static/categories.html.
// Each category has several 'id's.
// category_id is always synonymouc with their hexagon code.
// molen_id is individual for every single pin/rectangle/circle/polygon created. It ensures that each marking can be handled individually. ?>
<script>
// This JavaScript function will be called after the page loads
function loadCategories() {
    // Fetch the static/categories.html content
    fetch('static/categories.html')
        .then(response => response.text())
        .then(html => {
            // Parse the HTML and find the list items
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const categories = doc.querySelectorAll('li');

            // Create buttons from the list items
            const container = document.getElementById('dynamicgeneration-categorypicker');
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn';
                button.textContent = category.textContent;
                button.dataset.hex = category.dataset.hex;
                button.dataset.categoryId = category.dataset.categoryId;
                container.appendChild(button);
            });

            // Initialize the category buttons (to be implemented)
            initializeCategoryButtons();
        })
        .catch(error => {
            console.error('Error loading categories:', error);
        });
}

// Call the loadCategories function after the window loads
window.onload = loadCategories;
</script>
<script>
// Global variable to store the selected category
var selectedCategory = null;
var selectedObjectId = null; // Store the type of object to be drawn

// Function to initialize the drawing buttons
function initializeDrawingButtons() {
    document.querySelectorAll('.button-draw').forEach(button => {
        button.addEventListener('click', function() {
            // Deselect other buttons
            document.querySelectorAll('.button-draw').forEach(btn => btn.classList.remove('active'));
            // Select this button
            this.classList.add('active');
            // Store the selected object type
            selectedObjectId = this.getAttribute('data-type').toUpperCase();
            console.log('Object type selected:', selectedObjectId);
            // Start drawing
            startDrawing(selectedObjectId);
        });
    });
}

// Function to initialize the category buttons
function initializeCategoryButtons() {
    document.querySelectorAll('.categorybutton').forEach(button => {
        button.addEventListener('click', function() {
            // Deselect other categories
            document.querySelectorAll('.categorybutton').forEach(btn => btn.classList.remove('selected'));
            // Select this category
            this.classList.add('selected');
            // Store the selected category color
            selectedCategory = this.dataset.color;
            console.log('Category selected:', selectedCategory);
        });
    });
}

// Initialize the category buttons and drawing buttons when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', () => {
    initializeCategoryButtons();
    initializeDrawingButtons();
});

// Function to start drawing on the map
function startDrawing(drawType) {
    if (!selectedCategory) {
        console.log('No category selected.');
        alert('Please select a category before drawing.');
        return;
    }

    console.log('Starting to draw:', drawType);

    var drawOptions = {
        shapeOptions: {
            color: '#' + selectedCategory,
            fillColor: '#' + selectedCategory
        }
    };

    if (drawType === 'RECTANGLE') {
        new L.Draw.Rectangle(map, drawOptions).enable();
    } else if (drawType === 'CIRCLE') {
        new L.Draw.Circle(map, drawOptions).enable();
    } else if (drawType === 'POLYGON') {
        new L.Draw.Polygon(map, drawOptions).enable();
    } else if (drawType === 'MARKER') {
        new L.Draw.Marker(map).enable();
    }

    console.log('Drawing tool enabled for:', drawType);
}

// Function to handle draw creation event
map.on(L.Draw.Event.CREATED, function (e) {
    var layer = e.layer;
    var type = e.layerType.toUpperCase();

    if (selectedCategory && selectedObjectId) {
        // Set the style of the object based on the selected category's color
        layer.setStyle({
            color: '#' + selectedCategory,
            fillColor: '#' + selectedCategory
        });
        console.log('Object created with color:', selectedCategory);
        // Assign the objectId
        layer.objectId = selectedObjectId;
        console.log('Object ID assigned:', selectedObjectId);
    } else {
        console.log('No category color or object ID selected for the object.');
    }

    drawnItems.addLayer(layer);
});

// Call the initialize functions to set up the buttons
initializeCategoryButtons();
initializeDrawingButtons();
</script>
<?php CATEGORY PICKER MENU SCRIPT (GRABBING CATEGORIES FROM "static/categories.html")  END ?>
<script>
// Function to dynamically load the category buttons
function loadCategories() {
    const categoryPickerElement = document.getElementById('dynamicgeneration-categorypicker');
    if (categoryPickerElement) {
        // Assuming the server has a route '/categories' that serves the content of static/categories.html
        fetch('/categories').then(function(response) {
            return response.text();
        }).then(function(html) {
            categoryPickerElement.innerHTML = html;
        }).catch(function(error) {
            console.warn('Error loading categories:', error);
        });
    }
}

// Call loadCategories on page load
window.addEventListener('DOMContentLoaded', (event) => {
    loadCategories();
});
</script>
<?php DARK AND LIGHT MODE SWITCH START ?>
<script>
// Dark and light mode switcher
console.log("Dark and light mode switcher succesfully loaded.");
let isLightMode = false;  // Initialize with dark mode

// Ensure the dark mode is set on initial load
document.documentElement.classList.add('dark-mode');

// Function to switch between light and dark mode
function toggleLightMode() {
  // Toggle the mode first before applying the classes
  isLightMode = !isLightMode;
  
  // Apply the correct classes based on the toggled mode
  document.documentElement.classList.toggle('dark-mode', !isLightMode);
  document.documentElement.classList.toggle('light-mode', isLightMode);
  
  console.log("Toggling light mode.");
  
  const logoElement = document.querySelector('.logo-img');
  const pinlisticon = document.querySelector('#pinlistdiv img');
  const infoIcon = document.querySelector('#infoDiv img');
  const sunIcon = document.querySelector('#lightswitchDiv img');
  const keyIcon = document.querySelector('#keyDiv img');
  const counterContainer = document.getElementById('counter-container');
  const sidebar = document.getElementById('sidebar');
  const textElements = document.querySelectorAll('.text-color'); // Assuming all text elements have this class
  const h3Elements = document.querySelectorAll('.resistant-h3'); // Selecting all h3 elements with the class 'resistant-h3'


  if (isLightMode) {
    // Change to light mode styles
    document.body.style.backgroundColor = '#F4F4ED';
    logoElement.src = 'static/logo_long2.png';
    pinlisticon.src = 'static/pinlisticon2.png';
    infoIcon.src = 'static/infoicon2.png';
    sunIcon.src = 'static/sunicon2.png';
    keyIcon.src = 'static/keyicon2.png';
    counterContainer.style.backgroundColor = '#F4F4ED';
    counterContainer.style.color = 'black';
	sidebar.style.backgroundColor = '#D4D7DA';
    textElements.forEach(el => {
    el.style.color = 'black';
	});
	h3Elements.forEach(el => {
      el.style.color = 'black'; // Change h3 elements to black in light mode
    });
	
  } else {
    // Change to dark mode styles
    document.body.style.backgroundColor = '#1b1b1b';
    logoElement.src = 'static/logo_long.png';
    pinlisticon.src = 'static/pinlisticon.png';
    infoIcon.src = 'static/infoicon.png';
    sunIcon.src = 'static/sunicon.png';
    keyIcon.src = 'static/keyicon.png';
    counterContainer.style.backgroundColor = '#3a3a3a';
    counterContainer.style.color = 'white';
	sidebar.style.backgroundColor = '#111111';
    textElements.forEach(el => {
      el.style.color = 'white';
    });
	h3Elements.forEach(el => {
      el.style.color = 'white'; // Change h3 elements back to white in dark mode
    });
  }
}

// Add event listener to the light switch div
document.getElementById('lightswitchDiv').addEventListener('click', toggleLightMode);
</script>
<style>

/* Dark mode styles (default) */
.dark-mode {
    --bg-color1: #1b1b1b;
    --bg-color2: #111111;
    --bg-color3: #3a3a3a;
    --text-color: #ffffff;
    --logo-img: "static/logo_long.png";
    --key-icon: "static/keyicon.png";
    --sun-icon: "static/sunicon.png";
    --info-icon: "static/infoicon.png";
    --pinlist-icon: "static/pinlisticon.png";
	--border-hover-color: white; /* Set hover border color for dark mode */
    --border-selected-color: white; /* Set selected border color for dark mode */
}

/* Light mode styles */
.light-mode {
    --bg-color1: #F4F4ED;
    --bg-color2: #D4D7DA;
    --bg-color3: #000000;
    --text-color: #000000;
    --logo-img: "static/logo_long2.png";
    --key-icon: "static/keyicon2.png";
    --sun-icon: "static/sunicon2.png";
    --info-icon: "static/infoicon2.png";
    --pinlist-icon: "static/pinlisticon2.png";
	--border-hover-color: black !important; /* Set hover border color for light mode */
    --border-selected-color: black !important; /* Set selected border color for light mode */
}
</style>
<script>
// On website launch, the layout is DARK.
let isDarkMode = true;

function togglePopup() {
    isDarkMode = !isDarkMode;
    document.documentElement.classList.toggle('dark-mode', isDarkMode);
    document.documentElement.classList.toggle('light-mode', !isDarkMode);
}
</script>
<?php DARK AND LIGHT MODE SWITCH END ?>







<?php BUTTON CLICK AUDIO EFFECTS START ?>
<audio id="buttonClickAudio" preload="auto">
    <source src="static/buttonclick.mp3" type="audio/mp3"/>
</audio>
<script>
document.addEventListener('DOMContentLoaded', function() {
    function playClickSound() {
        // Create a new audio element for each click
        var audio = new Audio('static/buttonclick.mp3');
        // Attempt to play audio without waiting for the promise to resolve
        audio.play().catch(function(e) {
            console.error('Audio play failed:', e);
        });
    }

    // Attach event listener to the static parent element for delegation
    document.addEventListener('click', function(event) {
        // Ensure the clicked element matches the dynamic buttons
        if (event.target.closest('#dynamicgeneration-categorypicker .categorybutton')) {
            playClickSound();
        }
    });
});
</script>
<script>
// General click sound effect
document.addEventListener('DOMContentLoaded', function() {
    // Get the audio element
    const audio = document.getElementById('buttonClickAudio');
    
    // Add click event listener to all elements with class 'button-s'
    const buttonSs = document.querySelectorAll('.button-s');
    buttonSs.forEach((button) => {
        button.addEventListener('click', function() {
            audio.play();
        });
    });

    // Add click event listener to all elements with class 'categorybutton'
    const categorybuttons = document.querySelectorAll('.categorybutton');
    categorybuttons.forEach((button) => {
        button.addEventListener('click', function() {
            audio.play();
        });
    });
	
	    // Add click event listener to all elements with class 'button-s'
    const keyDivs = document.querySelectorAll('.key-div');
    keyDivs.forEach((button) => {
        button.addEventListener('click', function() {
            audio.play();
        });
    });
	
	    // Add click event listener to all elements with class 'button-s'
    const pinlistdivs = document.querySelectorAll('.pinlist-div');
    pinlistdivs.forEach((button) => {
        button.addEventListener('click', function() {
            audio.play();
        });
    });
	
		    // Add click event listener to all elements with class 'button-s'
    const lightswitchDivs = document.querySelectorAll('.lightswitch-div');
    lightswitchDivs.forEach((button) => {
        button.addEventListener('click', function() {
            audio.play();
        });
    });
	
		    // Add click event listener to all elements with class 'button-s'
    const infoDivs = document.querySelectorAll('.info-div');
    infoDivs.forEach((button) => {
        button.addEventListener('click', function() {
            audio.play();
        });
    });
	
});
</script>
<audio id="buttonClickAudio2"><source src="static/buttonclickSuccess.mp3" type="audio/mp3"/></audio>
<audio id="buttonClickAudio3"><source src="static/buttonclickClose.mp3" type="audio/mp3"/></audio>
<script>
// Popup closing sound effect
document.addEventListener('DOMContentLoaded', function() {
    // Get the audio elements
    const audioSuccess = document.getElementById('buttonClickAudio2');
    const audioClose = document.getElementById('buttonClickAudio3');
    
    // Add event listener to the body element for delegation
    document.body.addEventListener('click', function(event) {
            if (event.target.matches('.leaflet-popup-content button:nth-child(1)')) {
            audioSuccess.play();
        }     else if (event.target.matches('.leaflet-popup-content button:nth-child(2)')) {
            audioClose.play();
        }
    });
});
</script>
<?php BUTTON CLICK AUDIO EFFECTS END ?>
<?php RESIZE LOGIC GENERAL START ?>
<script>
function updateFontSize() {
    const windowWidth = window.innerWidth;
    const isMobile = windowWidth <= 780; // Check if the device is mobile
    const sidebar = document.querySelector('#sidebar');
    const containerWidth = sidebar.offsetWidth;


    const baseFontSize = isMobile ? Math.max(16, containerWidth / 20) : Math.max(12, containerWidth / 30);

    // Update the font sizes for elements as before
    document.querySelectorAll('#aboutBtn, #dropdown-button, #current-selection').forEach(el => {
        el.style.fontSize = `${baseFontSize}px`;
    });

    const regularH2FontSize = Math.min(30, baseFontSize);
    document.querySelectorAll('#sidebar h2:not(.centered-text-container h2)').forEach(h2 => {
        h2.style.fontSize = `${regularH2FontSize}px`;
    });

    const centeredH2FontSize = Math.max(15, containerWidth / 25);
    document.querySelectorAll('.centered-text-container h2').forEach(h2 => {
        h2.style.fontSize = `${centeredH2FontSize}px`;
    });

    // Handling categorybutton and button-s separately to prevent resizing until necessary
    ['categorybutton', 'button-s'].forEach(menuClass => {
        if (!isMobile) {
            document.querySelectorAll(`.${menuClass}`).forEach(el => {
                el.style.fontSize = 'initial';
            });
        } else {
            const menuWidth = document.querySelector(`.${menuClass}`).offsetWidth;
            const menuFontSize = Math.max(12, menuWidth / 30);
            document.querySelectorAll(`.${menuClass}`).forEach(el => {
                el.style.fontSize = `${menuFontSize}px`;
            });
        }
    });

    // Add the logic to scale the elements inside the 'smalloptionsmenutop' div
    const smalloptionsmenutopFontSize = Math.max(12, containerWidth / 30);
    document.querySelectorAll('.smalloptionsmenutop').forEach(div => {
        div.style.fontSize = `${smalloptionsmenutopFontSize}px`;
    });

        const sidebarHeight = sidebar.offsetHeight;
    const availableSpace = sidebarHeight - 17; // 17px away from the bottom
    const categorybuttonDesktop = document.querySelector('#categorybutton-container');
    const allPins = document.querySelectorAll('.categorybutton');

    const numberOfPins = allPins.length;
    const newMaxHeight = Math.max(20, Math.floor(availableSpace / numberOfPins) - 2); // -2 to account for margins

    allPins.forEach(pin => {
        pin.style.maxHeight = `${newMaxHeight}px`;
        // Force repaint for max-height to take effect
        void pin.offsetHeight;
    });
}
</script>
<?php RESIZE LOGIC GENERAL END ?>
<?php PILIST-CONTAINER POPUP OPENER START ?>
<script>
// This script opens the pinlist-container by clicking pinlist-div
    function togglePopup() {
        var pinlist = document.getElementById("pinlist-container");
        var overlayImage = document.getElementById("overlay-image");

        // Check the current display style of the pinlist and toggle it
        if (pinlist.style.display === "none" || pinlist.style.display === "") {
            pinlist.style.display = "block";
            overlayImage.style.display = "none";
        } else {
            pinlist.style.display = "none";
            overlayImage.style.display = "block";
        }
    }
</script>
<?php PILIST-CONTAINER POPUP OPENER END ?>
<?php SMALL OPTIONS BUTTON MENU TOP FUNCTIONALITY START ?>
<script>
// Ensures that each button within the smalloptionsmenutop container has the correct function assigned
const infoDiv = document.getElementById('infoDiv');
    if (infoDiv) {
        infoDiv.addEventListener('click', () => {
            window.open('https://info.stimmungskompass.at', '_blank');
        });
    }


    const keyDiv = document.querySelector("#keyDiv");
    if (keyDiv) {
        keyDiv.addEventListener("click", activatePopupByKey);
    }
</script>
<?php SMALL OPTIONS BUTTON MENU TOP FUNCTIONALITY END ?>
<?php BOTTOM RIGHT CORNER INFOPOPUP LOGIC START ?>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const popupTexts = {  
        'Login': {
            title: 'Admin-Zugriff',
            text: `<form id="loginForm" onsubmit="handleLogin(); return false;">
                <label for="username">Benutzer:</label>
                <input type="text" id="username" name="username"><br><br>

                <label for="password">Passwort:</label>
                <input type="password" id="password" name="password"><br><br>

                <label for="otp">OTP 2FA Token:</label>
                <input type="text" id="otp" name="otp"><br><br>

                <button type="submit" class="button-s" style="padding: 20px; background-color: #35b7ff; border: none; cursor: pointer;">
                    <span style="position: relative; top: 0px;">Anmelden</span>
                </button>
            </form>`,
            color: 'white',
            persist: true
        },
        'uigif-counter': {
            title: 'So funktioniert Filtern:',
            text: '<img src="static/uigif-counter.gif" alt="uigif-counter" style="max-width: 100%; max-height: 800px; width: auto; height: auto;">',
            color: '#ffffff',
            persist: true  // Keep this popup visible forever
        },
		'admin-pindelete': {
        title: 'Einzelne Pins löschen:',
        text: '<img src="static/uigif-deletebyid.gif" alt="uigif-deletebyid" style="max-width: 100%; max-height: 800px; width: auto; height: auto;">',
        color: '#ffffff',
        persist: true  // Keep this popup visible forever
		},
		'admin-pinresize': {
        title: 'Größenänderung:',
        text: '<img src="static/uigif-resize.gif" alt="uigif-resize" style="max-width: 100%; max-height: 800px; width: auto; height: auto;">',
        color: '#ffffff',
        persist: true  // Keep this popup visible forever
		},
        'Overlay': {
            title: 'Dieses Bild wird ersetzt:',
            text: '<img src="static/overlay.jpg" alt="Overlay Image" style="max-width: 100%; max-height: 400px; width: auto; height: auto; border-radius: 30px;">',
            color: '#ffffff',
            persist: true  // Keep this popup visible forever
        },
        'Success': {
            title: 'Anmeldung erfolgreich!',
            text: 'Wenn Sie Hilfe benötigen, sehen Sie sich die Anleitung an oder wenden Sie sich an den Entwickler.',
            color: 'green',
            persist: false
        },
        'Willkommen auf der Stimmungskarte!': {
            title: 'Willkommen auf der Stimmungskarte!',
            text: 'Diese Karte ist eine bequeme und einfache Möglichkeit, Ihrer Stadt zu zeigen, wie Sie sich darin fühlen.<br><br>Sie können Hinweise an Orten anbringen, die Sie entweder als angenehm oder problematisch empfinden.<br><br><span style="color: #f77f00; font-weight: bold;">Und so funktioniert es:</span><br><span style="color: #f77f00; font-weight: bold;">1.</span> Wählen Sie eine Kategorie.<br><span style="color: #f77f00; font-weight: bold;">2.</span> Platzieren Sie einen Pin auf der Karte.<br><span style="color: #f77f00; font-weight: bold;">3.</span> Teilen Sie uns Ihre Meinung mit!<br><br><span style="font-weight: bold;">Ihre Beiträge sind anonym und können von der Gemeinde zur Verbesserung des öffentlichen Raums genutzt werden.</span> ',
            color: '#f77f00'
        },
		<!-- CATEGORY EDITING AREA START -->
        'Dieser Ort gefällt mir.': {
            title: 'Was kann man zum Beispiel aufschreiben?',
            text: 'Dieser Ort strahlt eine beruhigende Ruhe aus und bietet eine angenehme Atmosphäre, die zum Entspannen einlädt.  Ob durch seine natürliche Schönheit oder aufregende Aktivitäten, er vermag es, einen positiven Eindruck zu hinterlassen.',
            color: '#FF7043'
        },
        'Hier fühle ich mich unsicher.': {
            title: 'Was kann man zum Beispiel aufschreiben?',
            text: 'Die schlechte Straßenbeleuchtung lässt ein Gefühl der Unsicherheit aufkommen, während betrunkene oder obdachlose Personen die Unbehaglichkeit weiter verstärken.   Hier wäre eine Aufwertung der öffentlichen Infrastruktur und mehr soziale Dienste wünschenswert.',
            color: '#B71C1C'
        },
        'Hier gibt es Probleme mit dem Parken.': {
            title: 'Was kann man zum Beispiel aufschreiben?',
            text: 'Die knappen Parkmöglichkeiten und rücksichtslos abgestellte Fahrzeuge erschweren die Durchfahrt und schaffen ein chaotisches Straßenbild.   Eine bessere Regulierung und Beschilderung könnte hier Abhilfe schaffen.',
            color: '#1565C0'
        },
        'Hier verbringe ich gerne meine Freizeit.': {
            title: 'Was kann man zum Beispiel aufschreiben?',
            text: 'Dieser Ort bietet eine friedliche Oase zum Abschalten oder ein lebendiges Markttreiben, das zum Stöbern einlädt.   Die angenehme Umgebung, sei es ein Bauernmarkt oder ein Kino, macht ihn zu einem beliebten Freizeitziel.',
            color: '#4CAF50'
        },
        'Dieser Ort braucht eine Verbesserung.': {
            title: 'Was kann man zum Beispiel aufschreiben?',
            text: 'Die fehlende Fußgängerüberquerung und der heruntergekommene Anblick, gepaart mit Schlaglöchern im Straßenbelag, rufen nach Verbesserungen.   Eine Aufwertung der Ästhetik und Sicherheit würde den Ort deutlich attraktiver machen.',
            color: '#4E342E'
        },
        'An diesem Ort fehlt ein Service.': {
            title: 'Was kann man zum Beispiel aufschreiben?',
            text: 'Die mangelhafte Busanbindung und geschlossene Apotheken erschweren den Alltag und lassen den Ort weniger serviceorientiert erscheinen.   Eine Verbesserung der öffentlichen Dienstleistungen wäre hier von Vorteil.',
            color: 'white'
        },
		<!-- CATEGORY EDITING AREA END -->

    };

    // Function to create and show the popup
    let popupTimer;
    let buttonTimer;

    function showPopup(info) {
        clearTimeout(popupTimer);
        const existingPopup = document.getElementById("info-popup");
        if (existingPopup) {
            existingPopup.remove();
        }
		
		

        const popup = document.createElement("div");
        popup.id = "info-popup";
        popup.style.backgroundColor = isLightMode ? "rgba(212,215,218, 1)" : "rgba(17, 17, 17, 1)";
        popup.style.color = isLightMode ? "black" : "white";
        popup.style.borderRadius = "30px";
        popup.style.position = "absolute";
        popup.style.bottom = "10px";
        popup.style.right = "10px";
        popup.style.marginLeft = "10px";
        popup.style.marginTop = "10px";
        popup.style.zIndex = "1000";
        popup.style.opacity = "0";
        popup.style.transition = "opacity 0.2s ease-in";

        const title = document.createElement("h3");
        title.style.color = info.color;
        title.style.fontWeight = "bold";
        title.style.fontSize = "24px";
        title.innerHTML = info.title;
        popup.appendChild(title);

        const text = document.createElement("p");
        text.style.fontWeight = "bold";
        text.style.fontSize = "18px";
        text.innerHTML = info.text;
        popup.appendChild(text);

        document.getElementById("map").appendChild(popup);

        popup.addEventListener('click', function (event) {
            event.stopPropagation();
        });

        setTimeout(() => {
            popup.style.opacity = "1";
        }, 0);

        let timeout = 5000;  // Default timeout in milliseconds
        if (info.title === 'Willkommen auf der Stimmungskarte!') {
            timeout = 15000;  // 15 seconds for 'Willkommen' popup
        } else if (info.title === 'Dieses Bild wird ersetzt:') {
            timeout = -1;  // Infinite for 'Overlay' popup
        }
		
		// Check if this is the 'uigif-counter' popup and add a specific class
		if (info.title === 'So funktioniert Filtern:') {
        popup.classList.add('uigif-counter-popup');
		} else if (info.title === 'Größenänderung:') {
        popup.classList.add('admin-pinresize-popup');
} else if (info.title === 'Einzelne Pins löschen:') {
    popup.classList.add('admin-pindelete-popup');

		}
		
        if (!info.persist) {
            clearTimeout(popupTimer);
            popupTimer = setTimeout(() => {
                popup.style.opacity = "0";
                setTimeout(() => {
                    popup.remove();
                }, 500);
            }, timeout);
        }
    }

    function activatePopup() {
        const info = popupTexts['Willkommen auf der Stimmungskarte!'];
        showPopup(info);
    }

    function activatePopupByKey() {
        const info = popupTexts['Login'];
        showPopup(info);

        const loginForm = document.getElementById("loginForm");
        if (loginForm) {
            loginForm.addEventListener("submit", function (event) {
                event.preventDefault();
                const formData = new FormData(loginForm);
                const username = formData.get("username");
                const password = formData.get("password");
                const otp = formData.get("otp");

                fetch("/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: `username=${username}&password=${password}&otp=${otp}`,
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === "success") {
                            const successInfo = popupTexts['Success'];
                            showPopup(successInfo);

                            const imageToHide = document.querySelector(".hide-on-mobile.resistant-image");
                            if (imageToHide) {
                                imageToHide.style.display = 'none';
                            }

                            const h3ElementsToHide = document.querySelectorAll(".resistant-h3");
                            if (h3ElementsToHide) {
                                h3ElementsToHide.forEach((element) => {
                                    element.style.display = 'none';
                                });
                            }

                            const adminTools = document.querySelector(".admintools-container");
                            if (adminTools) {
                                adminTools.style.display = 'block';
                            }
                        } else {
                            alert("Failed: " + data.message);
                        }
                    })
                    .catch(error => {
                        alert("An error occurred: " + error);
                    });
            });
        }
    }
	
// Add new code here
const counterContainer = document.getElementById('counter-container');
let isUIGifCounterPopupVisible = false;
// New code for admin-pindelete
const adminPinDelete = document.getElementById('adminpindelete');
let isAdminPinDeletePopupVisible = false;

if (adminPinDelete) {
    adminPinDelete.addEventListener('mouseover', () => {
        if (!isAdminPinDeletePopupVisible) {
            const adminPinDeleteInfo = popupTexts['admin-pindelete'];
            showPopup(adminPinDeleteInfo);
            isAdminPinDeletePopupVisible = true;
        }
    });

    adminPinDelete.addEventListener('mouseout', () => {
        if (isAdminPinDeletePopupVisible) {
            const existingPopup = document.getElementById("info-popup");
            if (existingPopup) {
                existingPopup.style.opacity = "0";
                setTimeout(() => {
                    existingPopup.remove();
                }, 500);
            }
            isAdminPinDeletePopupVisible = false;
        }
    });
}


if (counterContainer) {
    counterContainer.addEventListener('mouseover', (event) => {
        if (!isUIGifCounterPopupVisible) {
            const uigifCounterInfo = popupTexts['uigif-counter'];
            showPopup(uigifCounterInfo);
            isUIGifCounterPopupVisible = true;
        }
    });

    counterContainer.addEventListener('mouseout', (event) => {
        // Check if the mouse is actually leaving the counterContainer or simply moving to a child element
        const isMouseLeavingContainer = !counterContainer.contains(event.relatedTarget);
        
        if (isUIGifCounterPopupVisible && isMouseLeavingContainer) {
            const existingPopup = document.getElementById("info-popup");
            if (existingPopup) {
                existingPopup.style.opacity = "0";
                setTimeout(() => {
                    existingPopup.remove();
                }, 500);
            }
            isUIGifCounterPopupVisible = false;
        }
    });
}

// New code for admin-pinresize
const adminPinResize = document.getElementById('adminpinresize');
let isAdminPinResizePopupVisible = false;

if (adminPinResize) {
    adminPinResize.addEventListener('mouseover', () => {
        if (!isAdminPinResizePopupVisible) {
            const adminPinResizeInfo = popupTexts['admin-pinresize'];
            showPopup(adminPinResizeInfo);
            isAdminPinResizePopupVisible = true;
        }
    });

    adminPinResize.addEventListener('mouseout', () => {
        if (isAdminPinResizePopupVisible) {
            const existingPopup = document.getElementById("info-popup");
            if (existingPopup) {
                existingPopup.style.opacity = "0";
                setTimeout(() => {
                    existingPopup.remove();
                }, 500);
            }
            isAdminPinResizePopupVisible = false;
        }
    });
}

    let isOverlayPopupVisible = false;

    window.toggletitelbildMenu = function () {
        var titelbildMenu = document.getElementById('titelbild-menu');
        if (titelbildMenu.style.display === 'none') {
            titelbildMenu.style.display = 'block';
            const overlayInfo = popupTexts['Overlay'];
            showPopup(overlayInfo);
            isOverlayPopupVisible = true;
        } else {
            titelbildMenu.style.display = 'none';
            if (isOverlayPopupVisible) {
                const existingPopup = document.getElementById("info-popup");
                if (existingPopup) {
                    existingPopup.style.opacity = "0";
                    setTimeout(() => {
                        existingPopup.remove();
                    }, 500);
                }
                isOverlayPopupVisible = false;
            }
        }
    };
	

	
	// New code for infoDiv
    const infoDiv = document.getElementById('infoDiv');
    if (infoDiv) {
        infoDiv.addEventListener('click', () => {
            window.open('https://info.stimmungskompass.at', '_blank');
        });
    }


    const keyDiv = document.querySelector("#keyDiv");
    if (keyDiv) {
        keyDiv.addEventListener("click", activatePopupByKey);
    }

    const buttonS = document.querySelector(".button-s");
    if (buttonS) {
        buttonS.addEventListener("click", activatePopup);
    }

    const categorybuttons = document.querySelectorAll(".categorybutton");
    categorybuttons.forEach(menu => {
        menu.addEventListener("click", (event) => {
            const title = event.currentTarget.querySelector("h3").textContent;
            const info = popupTexts[title];
            showPopup(info);
        });
    });
});
</script>
<?php BOTTOM RIGHT CORNER INFOPOPUP LOGIC END ?>
<?php COUNTER-CONTAINER PINS FETCHING LOGIC START ?>
<script>
function fetchAndDisplayCounters() {
    // Fetch the counter data from the server
    fetch('/get_counters')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            let counterContainer = document.getElementById("counter-container");
            let counterContainerMobile = document.getElementById("counter-container-mobile");
            }

            // Clear the existing counters
            counterContainer.innerHTML = "";
            counterContainerMobile.innerHTML = "";

            pinOrder.forEach(pin_type => {  // Loop through pin types in the specified order
                let counterValue = data[pin_type];

                let counterCircle = document.createElement("div");
                counterCircle.className = "counter-circle";
                counterCircle.style.backgroundColor = "#" + pin_type;
                counterCircle.innerText = counterValue;

                let counterCircleMobile = counterCircle.cloneNode(true);
                counterCircleMobile.innerText = counterValue;

                counterContainer.appendChild(counterCircle);
                counterContainerMobile.appendChild(counterCircleMobile);
            });
        })
        .catch(error => {
            console.error('There has been a problem with your fetch operation:', error);
        });
}

// You can call this function on page load, or as often as needed to refresh the counter
fetchAndDisplayCounters();
document.addEventListener('DOMContentLoaded', (event) => {
    addToggleEventListeners();  // Add the toggle event listener to the existing buttons
});

</script>



<?php COUNTER-CONTAINER PINS FETCHING LOGIC END ?>



<?php ADMINTOOLS CATEGORIES TOGGLING START ?>
<script>
    function toggleCategory2Menu() {
        var category2Menu = document.getElementById('category2-menu');
        if (category2Menu.style.display === 'none') {
            category2Menu.style.display = 'block';
        } else {
            category2Menu.style.display = 'none';
        }
    }
</script>

<script>
function toggleHeatmapMenu() {
  var heatmapSettings = document.getElementById("heatmapSettings");
  if (heatmapSettings.style.display === "none" || heatmapSettings.style.display === "") {
    heatmapSettings.style.display = "block";
  } else {
    heatmapSettings.style.display = "none";
  }
}
</script>

<script>
    function toggleEditorMenu() {
        var editorMenu = document.getElementById('editor-menu');
        if (editorMenu.style.display === 'none') {
            editorMenu.style.display = 'block';
        } else {
            editorMenu.style.display = 'none';
        }
    }
</script>

<script>
    function togglePinsExportMenu() {
        var menu = document.getElementById('pinsexport-menu');
        var button = document.getElementById('pinsexport-menu-button');
        if (menu.style.display === 'none' || menu.style.display === '') {
            menu.style.display = 'block';
        } else {
            menu.style.display = 'none';
            button.classList.remove('toggled');
        }
    }
</script>
<?php ADMINTOOLS CATEGORIES TOGGLING END ?>



</body>
</html>