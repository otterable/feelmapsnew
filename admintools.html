    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Include stylesheet -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"/>
<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js">
</script>

<div class="admintools-container color-111111 text-white" style="display:block;             color: #ffffff;  /* This makes the text color white */ ; margin-top: 15px;  margin-bottom: 15px; border-radius: 30px">
<button class="button-s" id="aboutBtnEditor" onclick="toggleEditorMenu()" style="background-color: #35b7ff">Texteditor</button>

<!-- Popup Container -->


<!-- HEATMAPZ EDITOR ADMIN START -->





   
<div id="category-menu">
    <h2>Recolor Categories</h2>
    <select id="category-select">
        <!-- Category options will be dynamically generated -->
    </select>
    <input type="color" id="color-picker">
    <button type="button" id="update-color">Update Color</button>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Fetch categories and populate dropdown
    fetch('/get-categories').then(response => response.json()).then(data => {
        data.forEach(category => {
            // Append the category to the select dropdown
            $('#category-select').append(new Option(category.text, category.color));
        });

        // Set the initial value of the HEX editor to the first category's color
        $('#color-picker').val($('#category-select').val());
    });

    // Update the HEX editor when the selected category changes
    $('#category-select').change(function() {
        // Set the HEX editor to the currently selected category's color
        $('#color-picker').val($(this).val());
    });

    // Handle the color update
    $('#update-color').click(function() {
    var oldColor = $('#category-select').val();
    var newColor = $('#color-picker').val();
    console.log(`Updating color from ${oldColor} to ${newColor}`);

    // Update the category color
    $.ajax({
        url: '/update-category',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ oldColor: oldColor, newColor: newColor }),
        success: function(response) {
            console.log('Category color updated successfully:', response);
            
            // Now update the shapes in the database with the new color
            $.ajax({
                url: '/update-shape-colors',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ oldColor: oldColor, newColor: newColor }),
                success: function(response) {
                    console.log('Shapes color updated successfully:', response);
                    // Optionally refresh the map or shapes to reflect the color change
                },
                error: function(xhr, status, error) {
                    console.error('Error updating shapes color:', error);
                }
            });
        },
        error: function(xhr, status, error) {
            console.error('Error updating category color:', error);
        }
    });
});

});

</script>

<!-- Category Renaming Section -->
<div>
    <h2>Rename Category</h2>
    <select id="rename-category-select"></select>
    <input type="text" id="rename-category-name" placeholder="Enter new category name" />
    <button id="rename-category">Rename Category</button>
</div>

<script>
$(document).ready(function() {
    // Fetch categories and populate the rename dropdown
    fetch('/get-categories').then(response => response.json()).then(data => {
        data.forEach(category => {
            $('#rename-category-select').append(new Option(category.text, category.color));
            // Populate the hex editor with the current color
            $('#color-picker').val(category.color);
        });
    });

    // Handle the category rename
    $('#rename-category').click(function() {
        var color = $('#rename-category-select').val();
        var newName = $('#rename-category-name').val().trim();
        if (newName === "") {
            console.error('New category name is required');
            return;
        }
        console.log(`Renaming category ${color} to ${newName}`);
        
        $.ajax({
            url: '/rename-category',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ color: color, newName: newName }),
            success: function(response) {
                console.log('Category renamed successfully:', response);
                // Optionally refresh the categories in the dropdown and other related UI
            },
            error: function(xhr, status, error) {
                console.error('Error renaming category:', error);
            }
        });
    });
});

</script>

<!-- Category Creation Section -->
<div>
    <h2>Create New Category</h2>
    <input type="text" id="create-category-name" placeholder="Enter new category name" />
    <input type="color" id="create-category-color" />
    <button id="create-category">Create Category</button>
</div>
<script>
$(document).ready(function() {
    // Handle the category creation
    $('#create-category').click(function() {
        setTimeout(() => { // Adding a delay to ensure the input value is updated
            var name = $('#create-category-name').val().trim();
            var color = $('#create-category-color').val();
            console.log(`Inputted name: '${name}'`); // Log the inputted name for debugging
            console.log(`Selected color: '${color}'`); // Log the selected color for debugging
            
            if (name === "") {
                console.error('Category name is required');
                return;
            }
            console.log(`Creating new category '${name}' with color '${color}'`);
            
            $.ajax({
                url: '/create-category',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ name: name, color: color }),
                success: function(response) {
                    console.log('Category created successfully:', response);
                    // Optionally refresh the categories in the UI
                },
                error: function(xhr, status, error) {
                    console.error('Error creating category:', error);
                }
            });
        }, 100); // Delay of 100 milliseconds
    });
});
</script>

<!-- Category Deletion Section -->
<div>
    <h2>Delete Category</h2>
    <select id="delete-category-select">
        <!-- Options will be dynamically populated -->
    </select>
    <button id="delete-category">Delete Category</button>
</div>

<script>
$(document).ready(function() {
    // Populate the delete category dropdown
    fetchCategories();

    // Handle the category deletion
    $('#delete-category').click(function() {
        var color = $('#delete-category-select').val();
        console.log(`Deleting category with color ${color}`);

        $.ajax({
            url: '/delete-category',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ color: color }),
            success: function(response) {
                console.log('Category deleted successfully:', response);
                // Refresh the categories in the dropdowns
                fetchCategories();
            },
            error: function(xhr, status, error) {
                console.error('Error deleting category:', error);
            }
        });
    });
});

function fetchCategories() {
    fetch('/get-categories').then(response => response.json()).then(data => {
        var categorySelect = $('#delete-category-select');
        categorySelect.empty(); // Clear existing options
        data.forEach(category => {
            categorySelect.append(new Option(category.text, category.color));
        });
    });
}
</script>

<script>
    function toggleCategory2Menu() {
        var category2Menu = document.getElementById('category2-menu');
        if (category2Menu.style.display === 'none') {
            category2Menu.style.display = 'block';
        } else {
            category2Menu.style.display = 'none';
        }
    }
</script>


<button onclick="window.location.href='/export-geojson'">Export GeoJSON</button>
    
    <!-- Add a form for importing GeoJSON -->
    <form action="/import-geojson" method="POST" enctype="multipart/form-data">
        <input type="file" name="file" accept=".geojson">
        <button type="submit">Import GeoJSON</button>
    </form>

<!-- ADMINTOOLS CATEGORY LOADING END-->

<!-- Delete Objects by Category -->
<h2>Delete Objects by Category</h2>

<button id="delete-category-objects">Delete Only objects of the category</button>

<!-- Delete Objects by Object Type -->
<h2>Delete Objects by Object Type</h2>
<select id="delete-object-type-select">
    <option value="circle">Circle</option>
    <option value="rectangle">Rectangle</option>
    <option value="polygon">Polygon</option>
    <option value="polyline">Polyline</option>
    <option value="circlemarker">Circle Marker</option>
    <option value="marker">Marker</option>
    <!-- Add more object types as needed -->
</select>
<button id="delete-object-type-objects">Delete Objects</button>




<script>
$(document).ready(function() {
    // Populate the delete category dropdown
    fetchCategories();

    // Handle the category deletion
    $('#delete-category-objects').click(function() {
        var color = $('#delete-category-select').val();
        console.log(`Deleting objects with category color ${color}`);

        $.ajax({
            url: '/delete-objects-by-category',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ color: color }),
            success: function(response) {
                console.log('Objects deleted successfully:', response);
                // Refresh the categories in the dropdowns
                fetchCategories();
            },
            error: function(xhr, status, error) {
                console.error('Error deleting objects by category:', error);
            }
        });
    });

    // Handle the object type deletion
    $('#delete-object-type-objects').click(function() {
        var objectType = $('#delete-object-type-select').val();
        console.log(`Deleting objects of type ${objectType}`);

        $.ajax({
            url: '/delete-objects-by-object-type',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ objectType: objectType }),
            success: function(response) {
                console.log('Objects deleted successfully:', response);
                // Optionally refresh the map or shapes to reflect the deletion
            },
            error: function(xhr, status, error) {
                console.error('Error deleting objects by object type:', error);
            }
        });
    });

    // Other JavaScript code here...
});
</script>


<!-- Quill Editor -->
<div id="editor" style="height: 300px;"></div>
<button id="save-popup-content">Save</button>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize the color pickers with Spectrum
  $("#text-color-picker").spectrum({
    color: "#000", // Initial color
    change: function(color) {
      quill.format('color', color.toHexString());
    }
  });

  $("#highlight-color-picker").spectrum({
    color: "#fff", // Initial color, white for highlight
    change: function(color) {
      quill.format('background', color.toHexString());
    }
  });

  // Initialize Quill editor with custom color buttons
  var quill = new Quill('#editor', {
    theme: 'snow',
    modules: {
      toolbar: {
        container: [
          // Other toolbar options
          ['bold', 'italic', 'underline', 'strike'], // toggled buttons

          [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

		  [{ 'color': [] }, { 'background': [] }], // dropdown with defaults from theme
          [{ 'align': [] }],
		  
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          [{ 'script': 'sub'}, { 'script': 'super' }], // superscript/subscript


    

          ['clean'], // remove formatting button
		  ['image'], // Add button for image uploading

          ['textColorPicker', 'highlightColorPicker'], // custom color picker buttons
        ],
        handlers: {
          'textColorPicker': function() {
            $("#text-color-picker").spectrum("toggle");
          },
          'highlightColorPicker': function() {
            $("#highlight-color-picker").spectrum("toggle");
          }
        }
      }
    }
  });

// Load existing popup content
fetch('/popup-content').then(response => response.json()).then(data => {
    quill.root.innerHTML = data.content;
});

// Function to save popup content
document.querySelector('#save-popup-content').addEventListener('click', function(){
    let content = quill.root.innerHTML;
    fetch('/popup-content', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'content=' + encodeURIComponent(content)
    }).then(response => response.json()).then(data => {
        if(data.success) {
            alert('Popup content saved.');
        } else {
            alert('Error saving popup content.');
        }
    });
});

// Functions to handle popup display and cookies
function closePopup() {
    document.getElementById('popup-overlay').style.display = 'none';
}

function setCookie() {
    // Set a cookie to hide the popup in the future
    document.cookie = "hidePopup=true; max-age=86400; path=/";
    closePopup();
}

function imageHandler() {
  var range = this.quill.getSelection();
  var input = document.createElement('input');
  input.setAttribute('type', 'file');
  input.setAttribute('accept', 'image/*');
  input.click();

  input.onchange = () => {
    var file = input.files[0];
    // Implement the logic to handle the image file
    // This could involve uploading to a server and getting a URL, or converting to base64
    // For example:
    uploadImage(file).then((imageUrl) => {
      this.quill.insertEmbed(range.index, 'image', imageUrl);
    });
  };
}

// Example function for image uploading
async function uploadImage(file) {
  // Implement the logic for uploading the image and returning the URL
  // This is just a placeholder function
}


window.onload = function() {
  // Check if the cookie exists
  if(document.cookie.indexOf('hidePopup=true') == -1) {
    fetch('/popup-content').then(response => response.json()).then(data => {
      document.getElementById('popup-text').innerHTML = data.content;
      document.getElementById('popup-overlay').style.display = 'block';
    });
  }
};

// Close popup function
function closePopup() {
  document.getElementById('popup-overlay').style.display = 'none';
}

document.getElementById('popup-overlay').addEventListener('click', function(event) {
  if (event.target === this) {
    closePopup();
  }
});


});
</script>

<script>
// Function to update category dropdowns
function updateCategoryDropdowns() {
    console.log("Fetching updated categories from the server."); // Debugging statement

    fetch('/get-categories')
        .then(response => response.json())
        .then(categories => {
            console.log("Received categories:", categories); // Debugging statement

            // Dropdown elements
            const dropdowns = [
                document.getElementById('category-select'),
                document.getElementById('rename-category-select'),
                document.getElementById('delete-category-select')
            ];

            // Clear existing options in dropdowns
            dropdowns.forEach(dropdown => {
                while (dropdown.firstChild) {
                    dropdown.removeChild(dropdown.firstChild);
                }
            });

            // Add new options to dropdowns
            categories.forEach(category => {
                dropdowns.forEach(dropdown => {
                    const option = document.createElement('option');
                    option.value = category.text;
                    option.textContent = category.text;
                    option.style.color = category.color;
                    dropdown.appendChild(option);
                });
            });

            console.log("Dropdowns updated successfully."); // Debugging statement
        })
        .catch(error => {
            console.error("Error fetching categories:", error); // Debugging statement
        });
}
 updateCategoryDropdowns
</script>